/*! gx-core 2017-04-25 */
"use strict";if(void 0==gx)var gx={};if(gx.version="1.100",gx.core={},gx.ui={},"function"!=typeof String.prototype.htmlSpecialChars&&(String.prototype.htmlSpecialChars=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}),"function"!=typeof Array.prototype.findBy&&(Array.prototype.findBy=function(a,b){var c=a;"string"==typeof a&&(c=function(c){return c[a]===b});for(var d,e=this.length-1;e>=0;e--)if(d=this[e],c(d)===!0)return d;return null}),window.console&&"function"!=typeof window.console.error&&(window.console.error=window.console.log),gx.util={Console:function(a,b){b instanceof Error?console.error(a,b.stack):console.log(a+": "+b)},initValue:function(a,b,c){return null==a[b]?c:a[b]},initNum:function(a){switch(typeOf(a)){case"number":return a;case"string":return parseFloat(a);default:return 0}},attemptConvertionWith:function(a,b){if("object"!=typeof a)return a;var c=a[b];return"function"==typeof c?c.call(a):a},formatTime:function(a){if(gx.util.isString(a)){if(a.match(/^[0-9]{1,}:[0-9]{2}$/))return a;if(a.match(/^[0-9]{1,}:[0-9]{2,}$/))return a=a.replace(/[^0-9]/g,""),a.replace(/([0-9]{2})$/,":$1");a=parseInt(a.replace(/[^0-9]/g))}var b="";if(null==a||isNaN(a))return"0:00";0>a&&(a=-a,b="-");var c=a%60,d=Math.floor(a/60);return b+d+":"+(10>c?"0":"")+c},getMinutes:function(a){a=a.replace(/[^0-9:]/,"");var b=a.replace(/[^0-9:]/,"").split(":");return 1==b.length?parseInt(b.pop()):60*parseInt(b.shift())+parseInt(b.shift())},initFieldTime:function(a){return void 0==a&&(a=new Element("input",{type:"text"})),a.addEvent("blur",function(){this.set("value",gx.util.formatTime(this.get("value")))}),a.getMinutes=function(){return gx.util.getMinutes(a.get("value"))},a.set("value",gx.util.formatTime(a.get("value"))),a},formatNum:function(a,b,c,d){if(null==b&&(b="."),null==c&&(c=","),gx.util.isNumber(d)||(d=2),gx.util.isString(a)){{new RegExp("[^0-9"+b+"]","g")}a=parseFloat(a.replace(new RegExp("[^0-9"+b+"]"),"").replace(b,"."))}isNaN(a)&&(a=0),a=Math.round(a*Math.pow(10,d)).toString();for(var e=a.length;d>=e;e++)a="0"+a;var f=a.length-d;d>0&&(a=a.substring(0,f)+b+a.substring(f));for(var e=f-3;e>0;e-=3)a=a.substring(0,e)+c+a.substring(e);return a},getNumber:function(a,b){return parseFloat(a.replace(new RegExp("[^0-9"+b+"]"),"").replace(b,"."))},initFieldFloat:function(a,b,c,d){return void 0==a&&(a=new Element("input",{type:"text"})),a.addEvent("blur",function(){this.set("value",gx.util.formatNum(this.get("value"),b,c,d))}),a.getNumber=function(){return gx.util.getNumber(a.get("value"),b)},a.set("value",gx.util.formatNum(a.get("value"),b,c,d)),a},setElementContentByType:function(a,b){switch(typeOf(b)){case"string":a.set("html",b);break;case"element":a.empty(),a.adopt(b);break;case"object":a.empty(),a.adopt(__(b))}return a},adoptByType:function(a,b){switch(typeOf(b)){case"string":a.appendText(b);break;case"object":a.adopt(__(b));break;case"array":for(var c=0,d=b.length;d>c;c++)this.adoptByType(a,b[c]);break;default:a.adopt(b)}return a},printf:function(a,b){try{if(("string"==typeOf(b)||"number"==typeOf(b))&&(b=[b]),"array"==typeOf(b)){var c=a.split("%arg%");a="";var d=0;if(null!=b)for(;d<b.length;)a=a+" "+c[d],"string"==typeOf(c[d])?a+=b[d]:"number"==typeOf(c[d])&&(a+=b[d].toString()),d++;for(;d<c.length;)a+=c[d],d++;return a}return a}catch(e){throw Console("printf",e.message),e}},parseResult:function(a){var b=JSON.decode(a),c=typeOf(b);if("object"==c){if(null!=b.error)throw"Server error: "+String(b.error);if(null==b.result)throw"Undefined result";return b.result}throw"Invalid data type: "+c},Parse:function(a){switch(typeOf(a)){case"object":if(gx&&gx.ui&&gx.ui.Container&&instanceOf(a,gx.ui.Container)&&"function"==typeOf(a.display))return a.display();a.tag=null==a.tag?"div":a.tag;var b,c,d=new Element(a.tag);for(var e in a)switch(e){case"_adopt":this.adoptByType(d,a._adopt);break;case"styles":d.setStyles(a.styles);break;case"classes":"array"==typeOf(a.classes)?a.classes.each(function(a){d.addClass(a)}):d.addClass(a.classes);break;case"child":d.adopt(gx.util.Parse(a.child));break;case"children":if(b=a.children,"array"===typeOf(b)){c=[];for(var f=0,g=b.length;g>f;f++)c.push(gx.util.Parse(b[f]));d.adopt(c);break}var h=[];for(var i in a.children){var j=gx.util.Parse(a.children[i]);d.adopt(j),d["_"+i]="function"==typeOf(j.retrieve)&&j.retrieve("com")?j.retrieve("com"):j,h.push(i)}d.store("children",h);break;case"tag":break;default:e.length>5&&"on"==e.substring(0,2)&&e.substring(2,3)==e.substring(2,3).toUpperCase()?d.addEvent(e.substring(2).toLowerCase(),a[e]):d.set(e,a[e])}return d;case"string":return document.createTextNode(a);case"element":case"textnode":case"whitespace":return a}return!1},parseError:function(a){var b="\n";void 0!==arguments[1]&&(b=arguments[1]);var c=[];void 0!=a.fileName&&c.push("File: "+a.fileName),void 0!=a.lineNumber&&c.push("Line: "+a.lineNumber),void 0!=a.message&&c.push("Message: "+a.message);for(var d="",e=0;e<c.length;e++)d+=c[e]+b;return d},isArray:function(a){return"array"==typeOf(a)},isObject:function(a){return"object"==typeOf(a)},isFunction:function(a){return"function"==typeOf(a)},isString:function(a){return"string"==typeOf(a)},isNumber:function(a){return"number"==typeOf(a)},isElement:function(a){return"element"==typeOf(a)},isNode:function(a){var b=typeOf(a);return"element"==b||"textnode"==b}},1!=gx.noUnderscore)var __=gx.util.Parse;gx.core.Settings=new Class({gx:"gx.core.Settings",Implements:Events,options:{msg:{}},_theme:{},_language:null,_messages:null,_valid:!0,setOption:function(a,b){this.options[a]=b,this.fireEvent("setOption")},setOptions:function(a){if(null!=a&&null!=a.theme&&(Object.append(this._theme,a.theme),delete a.theme),"object"==typeOf(a)&&Object.append(this.options,a),this.addEvent)for(var b in a)"function"==typeOf(a[b])&&/^on[A-Z]/.test(b)&&(this.addEvent(b,a[b]),delete a[b]);this.fireEvent("setOption")},dispatchEvents:function(a,b){var c=this;b.each(function(b){a.addEvent(b,function(){c.fireEvent(b)})})},gxClass:function(a){var b=typeOf(a);if(!b)return this.gx;if("object"!=b)return!1;try{return a.gxClass()}catch(c){return!1}},initialize:function(a){this.setOptions(a),this._messages=this.options.msg,this._language=this.options.language},getMessage:function(a,b){return null!=this._language&&"en"!=this._language&&null!=this._messages[this._language]&&null!=this._messages[this._language][a]?gx.util.printf(this._messages[this._language][a],arguments):null!=this._messages[a]?gx.util.printf(this._messages[a],b):""},setLanguage:function(a){this._language=a},doDestroy:function(){delete this.options,delete this._language,delete this._messages},destroy:function(){this._valid&&(delete this._valid,this.removeEvents(),this.doDestroy())}}),gx.ui.Container=new Class({Extends:gx.core.Settings,options:{parent:window},_coordinates:{width:0,height:0,top:0,bottom:0,left:0,right:0},_ui:{},_parent:null,_display:{},initialize:function(a,b){var c=this;try{switch(this.parent(b),this._display.root=this.initDisplay(a),this._ui.root=this._display.root,this._ui.root.store("com",this),("element"==typeOf(this.options.parent)||"window"==typeOf(this.options.parent))&&(this._parent=this.options.parent),null!=this.options.styles&&this._ui.root.setStyles(this.options.styles),typeOf(this.options.classes)){case"array":this.options.classes.each(function(a){c._ui.root.addClass(a)});break;case"string":this._ui.root.addClass(this.options.classes)}this.getCoordinates(),this.fireEvent("build",this)}catch(d){alert("gx.ui.Container->initialize: "+d.stack)}},initDisplay:function(a,b){switch(typeOf(a)){case"string":return null==b?$(a):document.createTextNode(a);case"number":return document.createTextNode(a.toString());case"element":return a;case"object":return instanceOf(a,gx.ui.Container)&&"function"==typeOf(a.display)?a.display():__(a);default:return new Element("div")}},display:function(a){return this.fireEvent("display"),this._ui[a?a:"root"]},toElement:function(){return this.display()},setCoordinates:function(a){var b=this;try{var c=new Object;"number"==typeOf(a.width)&&(c.width=a.width),"number"==typeOf(a.height)&&(c.height=a.height),"number"==typeOf(a.top)&&(c.top=a.top),"number"==typeOf(a.bottom)&&(c.bottom=a.bottom),"number"==typeOf(a.left)&&(c.left=a.left),"number"==typeOf(a.right)&&(c.right=a.right),this._display.root.setStyles(c),this.fireEvent("resize")}catch(d){gx.util.Console(b.gx+"->setCoordinates",d.message)}},getCoordinates:function(){try{this._coordinates=this._display.root.getCoordinates(),this._coordinates.scrollx=this._display.root.getScrollSize().x,this._coordinates.scrolly=this._display.root.getScrollSize().y,this._coordinates.paddingtop=this._display.root.getStyle("padding-top").toInt(),this._coordinates.paddingright=this._display.root.getStyle("padding-right").toInt(),this._coordinates.paddingbottom=this._display.root.getStyle("padding-bottom").toInt(),this._coordinates.paddingleft=this._display.root.getStyle("padding-left").toInt(),this._coordinates.bordertop=this._display.root.getStyle("border-top-width").toInt(),this._coordinates.borderright=this._display.root.getStyle("border-right-width").toInt(),this._coordinates.borderbottom=this._display.root.getStyle("border-bottom-width").toInt(),this._coordinates.borderleft=this._display.root.getStyle("border-left-width").toInt(),this._coordinates.innerwidth=this._coordinates.width-this._coordinates.borderleft-this._coordinates.borderright-this._coordinates.paddingleft-this._coordinates.paddingright,this._coordinates.innerheight=this._coordinates.height-this._coordinates.bordertop-this._coordinates.borderbottom-this._coordinates.paddingtop-this._coordinates.paddingbottom}catch(a){}return this._coordinates},set:function(a,b){try{this._ui.root.set(a,b)}catch(c){}},setStyle:function(a,b){try{this._ui.root.setStyle(a,b)}catch(c){}},doDestroy:function(){this._ui.root instanceof Element&&(this._ui.root.destroy(),delete this._ui.root),delete this._coordinates,delete this._ui,delete this._parent,delete this._display,this.parent()}}),gx.ui.Blend=new Class({gx:"gx.ui.Blend",Extends:gx.ui.Container,options:{color:"#FFF",freezeColor:"#333",opacity:"0.8",transition:"quad:in",duration:"300",loader:!0,open:!1,"z-index":100},_isOpen:!1,_isFrozen:!1,_inAction:!1,initialize:function(a,b){var c=this;try{this.parent(a,b);var d=0,e=0,f="absolute";if(this._display.root==document.body){var f="fixed";d=c._coordinates.top,e=c._coordinates.left}this._display.blend=new Element("div",{"class":"gxUiBlend",styles:{"background-color":c.options.color,opacity:"0",display:"none","z-index":c.options["z-index"],position:f,top:d,left:e}}),this.options.loader&&this._display.blend.addClass("class","gxUiBlendLoader"),this.init(),this._display.blend.inject(this._display.root),this.options.open&&(this._isOpen=!0,this._display.blend.setStyles({opacity:c.options.opacity,display:"block"})),this._parent.addEvent("resize",function(){c.getCoordinates(),c._display.blend.setStyles(c._coordinates)}),this._display.blend.addEvent("click",function(a){c.fireEvent("click",[a])}),this._display.blend.addEvent("dblclick",function(a){c.fireEvent("dblclick",[a])})}catch(g){gx.util.Console("gx.ui.Blend->initialize",g.message)}},init:function(){var a=this;this.getCoordinates();var b=0;this._display.root==document.body&&(b=100),this._display.blend.setStyles({width:a._coordinates.width+b,height:a._coordinates.height+b})},start:function(a){var b=this;try{if(this._isOpen!=a&&!this._isFrozen){a&&this._display.blend.setStyle("display","block"),this._isOpen=a;var c=new Fx.Tween(this._display.blend,{property:"opacity",duration:b.options.duration,transition:b.options.transition,link:"cancel",onComplete:function(){a?b.fireEvent("show"):(b._display.blend.setStyle("display","none"),b.fireEvent("hide")),b.fireEvent("complete")}});this._display.blend.store("tween",c),c.start(a?this.options.opacity:.01)}}catch(d){gx.util.Console(b.gx+"->start",d.message)}},lock:function(a){var b=this;try{if(this._isFrozen!=a){var c=new Fx.Morph(this._display.blend,{duration:b.options.duration,transition:b.options.transition,onStart:function(){a&&b._display.blend.removeClass("class","gxUiBlendLoader")},onComplete:function(){b._isOpen=a,b._isFrozen=a,a?b.fireEvent("freeze"):(b._display.blend.setStyle("display","none"),b.fireEvent("unfreeze"),b.options.loader&&b._display.blend.addClass("class","gxUiBlendLoader"))}});a&&this._display.blend.setStyle("display","block"),c.start({"background-color":a?b.options.freezeColor:b.options.color,opacity:a?b.options.opacity:0})}}catch(d){gx.util.Console(b.gx+"->lock",d.message)}},freeze:function(){this.lock(1)},unfreeze:function(){this.lock(0)},show:function(){this.start(1)},hide:function(){this.start(0)},toggle:function(){this.start(!this._isOpen)}}),gx.ui.Collapse=new Class({gx:"gx.ui.Collapse",Extends:gx.ui.Container,options:{duration:"300",transition:"quad:in",open:!0,mode:"vertical",width:"auto",height:"auto",minHeight:0,minWidth:0,minOpacity:0},_isOpen:!0,_refresh:!1,_styleOpen:{opacity:1},_styleClose:null,initialize:function(a,b){var c=this;try{this.parent(a,b),this.styleNative={display:"block",overflow:"hidden",width:c.options.width,height:c.options.height},this._styleClose={opacity:c.options.minOpacity},c.update(),this.addEvent("update",function(){c.update()}),this.options.open?this.show():this.hide()}catch(d){gx.util.Console("gx.ui.Collapse->initialize",d.message)}},update:function(){var a=this;try{this._isOpen?(("horizontal"==this.options.mode||"both"==this.options.mode)&&(this._styleClose.width=[this._coordinates.width,this.options.minWidth],this._styleOpen.width=[this.options.minWidth,this._coordinates.width]),("vertical"==this.options.mode||"both"==this.options.mode)&&(this._styleClose.height=[this._coordinates.height,this.options.minHeight],this._styleOpen.height=[this.options.minHeight,this._coordinates.height])):this.refresh=!0}catch(b){gx.util.Console(a.gx+"->update",b.message)}},show:function(){var a=this;try{this._isOpen=!0,this._display.root.setStyles({display:"block",width:this.options.width,height:this.options.height})}catch(b){gx.util.Console(a.gx+"->show: ",b.message)}},hide:function(){var a=this;try{this._isOpen=!1,this.options.minWidth<1||this.options.minHeight<1?this._display.root.setStyle("display","none"):"number"!=typeOf(this.options.minWidth)||"horizontal"!=this.options.mode&&"both"!=this.options.mode?"number"!=typeOf(this.options.minHeight)||"vertical"!=this.options.mode&&"both"!=this.options.mode||this._display.root.setStyle("height",this.options.minHeight):this._display.root.setStyle("width",this.options.minWidth)}catch(b){gx.util.Console(a.gx+"->hide: ",b.message)}},start:function(a){var b=this;try{if(this._isOpen!=a){a?this._display.root.setStyle("display","block"):this._display.root.setStyle("overflow","hidden");var c=new Fx.Morph(this._display.root,{duration:b.options.duration,transition:b.options.transition,onComplete:function(){a?(b.show(),b.refresh&&b.getCoordinates(),b.fireEvent("show")):(b.hide(),b.fireEvent("hide")),b.fireEvent("resize")}});c.start(a?this._styleOpen:this._styleClose)}}catch(d){gx.util.Console(b.gx+"->start",d.message)}},open:function(){this.start(1)},close:function(){this.start(0)},toggle:function(){this.start(!this._isOpen)}}),gx.ui.HGroup=new Class({Extends:gx.ui.Container,options:{},_isOpen:!0,initialize:function(a){var b=this;display=new Element("table",{"class":"group"}),this.parent(display,{}),this._ui.row=new Element("tr"),this._ui.body=new Element("tbody"),this._ui.root.adopt(this._ui.body.adopt(this._ui.row)),a.each(function(a){b.addElem(a.content,a.width,a.styles,a.align,a.properties)})},addElem:function(a,b,c,d,e){var f=new Element("td",{style:"vertical-align:top;"});null!=b&&f.setStyle("width",b),null!=c&&f.setStyles(c),null!=d&&f.setStyle("vertical-align",d),f.adopt(this.initDisplay(a)),e&&f.set(e),this._ui.row.adopt(f)}}),gx.ui.Hud=new Class({gx:"gx.ui.Hud",Extends:gx.ui.Container,options:{background:"#333",opacity:"0.8",transition:"quad:in",duration:"300",open:!0,blend:!0,x:"center",y:"center"},_isOpen:!1,_children:{},_active:[],_position:{},initialize:function(a,b){var c=this;try{null==a&&(a=document.body),this.parent(a,b),this._display.hud=new Element("div",{styles:{position:"relative",background:this.options.background}}),this._blend=new gx.ui.Blend(a,{opacity:c.options.opacity,transition:c.options.transition,loader:!1,open:!1}),a.adopt(this._display.hud),this._blend.addEvent("click",function(a){c.fireEvent("click",[a])}),this._blend.addEvent("dblclick",function(a){c.fireEvent("dblclick",[a])}),this.options.open&&(this._isOpen=!0,this._display.hud.setStyles({opacity:1,display:"block"})),this._parent.addEvent("resize",function(){c.getCoordinates();var a=Object.clone(c._coordinates);delete a.height,c._display.hud.setStyles(a)}.bind(this))}catch(d){gx.util.Console("gx.ui.Hud->initialize",d.stack)}},setPosition:function(a,b,c){try{null==b&&(b=this.options.x),null==c&&(c=this.options.y),this.getCoordinates();var d=a.getCoordinates();"left"==b?a.setStyle("left",0):"right"==b?a.setStyle("left",this._coordinates.width-d.width):a.setStyle("left",(this._coordinates.width-d.width)/2),"top"==c?a.setStyle("top",0):"bottom"==c?a.setStyle("top",this._coordinates.height-d.height):a.setStyle("top",(this._coordinates.height-d.height)/2)}catch(e){gx.util.Console("gx.ui.Hud->setPosition: ",e.message)}},add:function(a,b,c,d){var e=this;if(null==c&&(c={}),null==c.x&&(c.x=this.options.x),null==c.y&&(c.y=this.options.y),1==d)var f="fixed";else var f="absolute";this._children[a]=b,this._position[a]=c,b.inject(this._display.hud),b.setStyles({opacity:0,visibility:"hidden",position:f}),this._parent.addEvent("resize",function(){e.setPosition(b,c.x,c.y)}),this.setPosition(b,c.x,c.y)},show:function(a,b,c){if(1==b&&this.showBlend(),null!=c&&1==c)for(child in this._children)child==a?(this._children[child].fade("in"),this._active.push(child)):(this._children[child].fade("out"),this._active.erase(child));else null!=this._children[a]&&(this._children[a].fade("in"),this._active.push(a));null!=this._children[a]&&this.setPosition(this._children[a],this._position[a].x,this._position[a].y)},hide:function(a){if(null!=a)this._children[a].fade("out");else for(child in this._children)this.hide(child);this._active.length<1&&alert(JSON.encode(this._active)),this.hideBlend()},showBlend:function(){this._blend.freeze()},hideBlend:function(){this._blend.unfreeze()}}),gx.ui.Popup=new Class({gx:"gx.ui.Popup",Extends:gx.ui.Blend,options:{color:"#FFF",freezeColor:"#FFF","z-index":110,opacity:"0.95",position:"fixed",transition:"quad:in",duration:"300",loader:!1,open:!1,content:null,x:"center",y:"center"},isOpen:!0,initialize:function(a,b){var c=this;try{this.parent(a,b),this.build(),this.options.content&&this.addContent(this.options.content),this._parent.addEvent("resize",function(){c.setPosition()})}catch(d){gx.util.Console("gx.ui.Popup->initialize: ",d.message)}},build:function(){try{this._display.content=new Element("div",{styles:{position:this.options.position,display:"none","z-index":this.options["z-index"],opacity:0}}),this._display.content.inject(this._display.root)}catch(a){gx.util.Console("gx.ui.Popup->build: ",a.message)}},addContent:function(a){try{a=this.initDisplay(a),this._display.content.adopt(a),this.setPosition()}catch(b){gx.util.Console("gx.ui.Popup->addContent: ",b.message)}},setPosition:function(a,b){try{null==a&&(a=this.options.x),null==b&&(b=this.options.y),this.getCoordinates();var c=this._display.content.getCoordinates();"left"==a?this._display.content.setStyle("left",0):"right"==a?this._display.content.setStyle("left",this._coordinates.width-c.width):this._display.content.setStyle("left",(this._coordinates.width-c.width)/2),"top"==b?this._display.content.setStyle("top",0):"bottom"==b?this._display.content.setStyle("top",this._coordinates.height-c.height):this._display.content.setStyle("top",(this._coordinates.height-c.height)/2)}catch(d){gx.util.Console("gx.ui.Popup->setPosition: ",d.message)}},show:function(){var a=this;try{var b=new Fx.Morph(this._display.content,{onStart:function(){a._display.content.setStyle("display","block")}});this.lock(1),b.start({opacity:1}),this.setPosition(),this.fireEvent("show")}catch(c){gx.util.Console("gx.ui.Popup->show: ",c.message)}},hide:function(){var a=this;try{var b=new Fx.Morph(this._display.content,{onComplete:function(){a._display.content.setStyle("display","none")}});this.lock(0),b.start({opacity:0}),this.fireEvent("hide")}catch(c){gx.util.Console("gx.ui.Popup->hide: ",c.message)}}}),gx.ui.SimpleTable=new Class({Implements:[Options,Events],options:{cols:[],structure:function(a){return[a.col1,{label:a.col2,className:a.col2class}]},tableCss:"table table-striped table-hover",fireRowClick:!1},initialize:function(a,b){this.setOptions(b),this.build(a),this.buildCols(this.options.cols)},build:function(a){this._display={};var b=this._display.root="element"===typeOf(a)?a:new Element("table");"table"===b.get("tag")?this._display.table=b:(this._display.table=new Element("table"),b.adopt(this._display.table)),this._display.table.addClass(this.options.tableCss),this._display.tbody=new Element("tbody"),this._display.thead=new Element("thead"),this._display.table.adopt(this._display.thead,this._display.tbody)},buildCols:function(a){var b=new Element("tr");this._display.thead.empty(),this._display.thead.adopt(b),a.each(function(a){var c=new Element("th",{"class":""});switch(a.properties&&c.set(a.properties),typeOf(a.label)){case"object":c.adopt(__(a.label));break;case"element":c.adopt(a.label);break;default:c.set("html",a.label)}b.adopt(c)})},setData:function(a){return this.empty(),this.addData(a)},addData:function(a){a.each(function(a,b){this.addRow(a,b)}.bind(this))},createRow:function(a,b){var c=this,d=c.options.structure(a,b,c),e={};d.row&&d.properties&&(Object.merge(e,d.properties),d=d.row);for(var f=new Element("tr",e),g=0,h=d.length;h>g;g++){var i=d[g],j=new Element("td");switch(typeOf(i)){case"object":var k=i.label;k instanceof Element?j.adopt(k):j.set("html",k),i=Object.clone(i),i.className&&j.addClass(i.className),delete i.label,delete i.className,j.set(i);break;case"element":j.adopt(i);break;default:j.set("html",i)}f.adopt(j)}return this.options.fireRowClick===!0&&f.addEvent("click",function(){c.fireEvent("click",[a,b])}),f},addRow:function(a,b){var c=this.createRow(a,b);return this._display.tbody.adopt(c),c},updateRow:function(a,b){var c,d=this._display.tbody;c="undefined"!=typeof d.childNodes?d.childNodes[b]:d.getChildren()[b];var e=this.createRow(a,b);return e.replaces(c),e},removeRow:function(a){var b,c=this._display.tbody;b="undefined"!=typeof c.childNodes?c.childNodes[a]:c.getChildren()[a],b&&$(b).destroy()},getRows:function(){return this._display.tbody.childNodes},empty:function(){this._display.tbody.empty()},toElement:function(){return this._display.root}}),gx.ui.Tabbox=new Class({gx:"gx.ui.Tabbox",Extends:gx.ui.Container,options:{frames:[],height:!1,show:1,onChange:!1},class_active:"active",_tabs:[],_frames:[],_active:!1,initialize:function(a,b){var c=this;try{this.parent(a,b),this.build();var d=this.options.frames;if(d instanceof Array)for(var e=0;e<d.length;e++){var f=d[e];c.addTab(f.name,f.title,f.content,f.properties)}if("function"==typeof this.options.onChange&&this.addEvent("change",this.options.onChange),"string"==typeOf(this.options.show))this.openTab(this.options.show);else if("number"==typeof this.options.show){var g=this.getIndexName(this.options.show);g&&this.openTab(g)}}catch(h){gx.util.Console("gx.ui.Tabbox->initialize",h.message)}},isNode:function(a){return"object"==typeof a&&1==a.nodeType},build:function(){try{this._display=Object.merge({},this._display,{tabfull:new Element("td",{"class":"fullw"}),tablist:new Element("tr"),table:new Element("table",{"class":"tab"}),content:new Element("div",{styles:{overflow:"auto"}})}),root.options.height&&this._display.content.setStyle("height",this.options.height),this._display.tablist.adopt(new Element("td")),this._display.tablist.adopt(this._display.tabfull),this._display.table.adopt(this._display.tablist),this._display.root.adopt(this._display.table),this._display.root.adopt(this._display.content)}catch(a){gx.util.Console("gx.ui.Tabbox->build",a.message)}},buildTab:function(a,b){var c=this,d=new Element("a",{html:String(b).replace(/ /g,"&nbsp;")}),e=new Element("th");return e.adopt(d),e.inject(this._display.tabfull,"before"),d.addEvent("click",function(){c.openTab(a)}),e},buildContent:function(a){return this._display.content.adopt(a),a},setHeight:function(a){this._display.content.setStyle("height",a)},addTab:function(a,b,c,d){var e=this;try{switch(typeOf(c)){case"string":c=new Element("div",{html:c});break;case"element":break;default:c=$(c)}if("string"==typeOf(a)&&"string"==typeOf(b)&&"element"==typeOf(c)&&"element"!=typeOf(this._tabs[a])){var f=e.buildTab(a,b);return d&&f.set(d),c=e.buildContent(c),c.setStyle("display","none"),this._frames[a]=c,this._tabs[a]=f,!0}return!1}catch(g){throw gx.util.Console("gx.ui.Tabbox->addTab",g.message),g}},getTabName:function(){return this._active},setTabTitle:function(a,b){return this.isNode(this._tabs[a])&&this.setTabObjectTitle(this._tabs[a],b),this},setTabObjectTitle:function(a,b){var c=a.getElement(">a:first-child");return c&&c.set("html",String(b).replace(/ /g,"&nbsp;")),this},closeTab:function(a){try{this.isNode(this._tabs[a])&&(this._tabs[a].removeClass(this.class_active),this._frames[a].setStyle("display","none"),this._active=!1)}catch(b){gx.util.Console("gx.ui.Tabbox->closeTab",b.message)}},openTab:function(a,b){try{if(!this.isNode(this._tabs[a]))return this;this._active&&this.closeTab(this._active),this._active=a,this._tabs[a].addClass(this.class_active),this._frames[a].setStyle("display","block"),this.fireEvent("change",[a,b,this])}catch(c){gx.util.Console("gx.ui.Tabbox->openTab",c.message)}return this},reopen:function(){return this.openTab(this._active)},hideTab:function(a){return this.isNode(this._tabs[a])&&this._tabs[a].hide(),this},revealTab:function(a){return this.isNode(this._tabs[a])&&this._tabs[a].show(),this},getIndexName:function(a){var b=0;for(name in this._tabs)if(b++,b==a)return name;return!1}}),gx.ui.Table=new Class({gx:"gx.ui.Table",Extends:gx.ui.Container,options:{cols:[{label:"Column 1",id:"col1",width:"20px",filter:"asc"},{label:"Column 2",id:"col2"}],structure:function(a){return[a.col1,{label:a.col2,className:a.col2class}]},stopPropagation:!1,height:!1,data:[]},_theme:{asc:"asc",desc:"desc",unfiltered:"",th:"th",filter:"filter",table_head:"view",table_head_tr:"",table_body:"view fixed",table_body_tr:"em",filter_elem:"div"},_cols:[],_filter:!1,_colspan:0,_scrollBarCol:!1,initialize:function(a,b){try{this.parent(a,b),this.theme=this._theme,this.addEvent("complete",this.adoptSizeToHead.bind(this)),this.build(),this.options.height&&this.setHeight(this.options.height),this.buildCols(this.options.cols),this.setData(this.options.data),window.addEvent("resize",this.adoptSizeToHead.bind(this))}catch(c){gx.util.Console("gx.ui.Table->initialize",c.message)}},build:function(){try{this._display.root.addClass("gxComTable"),this._display.hiddenTableHead=new Element("thead",{"class":this.theme.table_head}),this._display.tbody=new Element("tbody"),this._display.thead=new Element("thead"),this._display.table=new Element("table",{"class":this.theme.table_body}).adopt(this._display.hiddenTableHead,this._display.tbody),this.options.simpleTable?this._display.root.adopt(this._display.table):(this._display.hiddenTableHead.hide(),this._display.tableDiv=new Element("div",{style:"overflow-y:scroll;"}).adopt(this._display.table),this._display.root.adopt(new Element("table",{"class":this.theme.table_head}).adopt(this._display.thead),this._display.tableDiv))}catch(a){gx.util.Console("gx.ui.Table->build",a.message)}},buildFilterIndicator:function(a){var b=this;return a.indicator=new Element(this.theme.filter_elem,{"class":this.theme.filter}),a.indicator.inject(a.th,"top"),a.th.addEvent("click",function(){b.setSort(a)}),a},buildCols:function(a){this.options.cols=a;var b=this;try{var c=new Element("tr",{"class":this.theme.table_head_tr});b._display.thead.empty(),b._display.thead.adopt(c),a.each(function(a){switch(a.th=new Element("th",{"class":b.theme.th}),a.properties&&a.th.set(a.properties),typeOf(a.label)){case"object":a.th.adopt(__(a.label));break;case"element":a.th.adopt(a.label);break;default:a.th.set("html",a.label)}(null!=a.filter||0!=a.filterable)&&(a=b.buildFilterIndicator(a)),null!=a.width&&a.th.setStyle("width",a.width),null!=a.filter&&b.setSort(a,a.filter,1),c.adopt(a.th),b._cols.push(a)}),this._display.hiddenTableHead.empty().adopt(this._display.thead.clone().getChildren()),this.options.simpleTable||this._display.table.setStyle("margin-top",-1*this._display.hiddenTableHead.getStyle("height").toInt()),this._colspan=a.length,this._scrollBarCol=new Element("th",{"class":"b_l",style:"width: "+gx.Browser.scrollBar.width+"px; padding: 0px;"}),c.adopt(this._scrollBarCol)}catch(d){gx.util.Console("gx.ui.Table->buildCols",d.message)}return this},setHeight:function(a){return(this._display.tableDiv||this._display.table).setStyle("height",a),this},setSort:function(a,b,c){try{if(this._filter){if(this._filter.id==a.id)return"asc"==this._filter.mode&&null==b||null!=b&&"desc"==b?(this._filter.indicator.removeClass(this.theme.asc),this._filter.indicator.addClass(this.theme.desc),this._filter.mode="desc"):(this._filter.indicator.removeClass(this.theme.desc),this._filter.indicator.addClass(this.theme.asc),this._filter.mode="asc"),null==c&&this.fireEvent("filter",a),this;this._filter.indicator.removeClass(this.theme.asc),this._filter.indicator.removeClass(this.theme.desc)}(null==b||"desc"!=b)&&(b="asc"),this._filter=a,this._filter.indicator.addClass(this.theme[b]),this._filter.mode=b,null==c&&this.fireEvent("filter",a)}catch(d){gx.util.Console("gx.ui.Table->setSort",d.message)}return this},getFilter:function(){return this._filter},setData:function(a){return this.empty(),this.fireEvent("setData",a),this.addData(a)},addData:function(a){var b=this,c=!1;try{if("array"!=typeOf(a))return this;this.fireEvent("addData",a),a.each(function(a,d){if("object"==typeOf(a)){var e=b.options.structure(a,d,b),f={};if("object"==typeof e&&e.row&&(Object.merge(f,e.properties),e=e.row),"array"==typeOf(e)){b.fireEvent("beforeRowAdd",a),a.tr=new Element("tr",f).addClass(b.theme.table_body_tr);var g=null==a.clickable||0!=a.clickable;c&&a.tr.addClass("bg"),c=!c,e.each(function(c,d){g=g?!(null!=b.options.cols[d]&&0==b.options.cols[d].clickable):!0;var e=new Element("td"),f=!1;switch((f=b.options.cols[d].width)&&e.setStyle("width",f),typeOf(c)){case"object":var h=c.label;h instanceof Element?e.adopt(h):e.set("html",h),c=Object.clone(c),g=null==c.clickable||0!=c.clickable,null!=c.className&&e.addClass(c.className),delete c.label,delete c.clickable,delete c.className,e.set(c);break;case"element":e.adopt(c);break;default:e.set("html",c)}g&&(e.addEvent("click",function(c){b.options.stopPropagation&&c.stopPropagation(),b.fireEvent("click",[a,c])}),e.addEvent("dblclick",function(c){b.options.stopPropagation&&c.stopPropagation(),b.fireEvent("dblclick",[a,c])})),a.tr.adopt(e)}),b._display.tbody.adopt(a.tr),b.fireEvent("rowAdd",a),b.fireEvent("afterRowAdd",a)}}}),this.fireEvent("complete",a)}catch(d){gx.util.Console("gx.ui.Table->addData",d.message)}return this},empty:function(){return this._display.tbody.empty(),this},adoptSizeToHead:function(){var a=this._display.tbody.getElement("tr");return null==a?this:(a.getElements("td").each(function(a){var b=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,null).getPropertyValue("width"):a.getComputedSize({styles:[],mode:"horizontal"}).width.toInt();this._cols[a.cellIndex]&&this._cols[a.cellIndex].th.setStyle("width",b)}.bind(this)),this)}}),gx.ui.TemplatesClass=new Class({Binds:["createElement"],isInline:0,storageReference:null,dataReference:null,templates:{},initialize:function(){this.boundRenderInline=this.renderInline.bind(this)
},createElement:function(){var a,b=arguments[0],c=typeOf(b);if("element"===c)a=b;else{if("string"!==c){if("function"===c)return this.boundRenderInline.apply(this,[b].append(Array.prototype.slice.call(arguments,1)));throw new Error("InvalidArgumentsException: Invalid tag name argument type: "+c)}if("~="===b.substr(0,2))return this.boundRenderInline.apply(this,[b.substr(2)].append(Array.prototype.slice.call(arguments,1)));a=new Element(b)}for(var d,e,f,g=0,h=arguments.length;++g<h;)if(d=arguments[g])if(c=typeOf(d),"string"===c)if(e=d.substring(0,2),".="===e)a.addClass(d.substring(2));else if(":="===e){if(void 0===this.references)continue;this.references[d.substring(2)]=a}else a.appendText(d);else if("element"===c)a.adopt(d);else if("function"===c){if(f=d.call(this,this.createElement,this.dataReference,this),void 0===f)continue;Array.isArray(f)||(f=[f]),Array.prototype.splice.apply(arguments,[g+1,0].concat(f)),h=arguments.length}else"array"===c?(Array.prototype.splice.apply(arguments,[g+1,0].concat(d)),h=arguments.length):"object"===c&&a.set(d);return a},register:function(a,b){return this.templates[a]=b,this},render:function(){var a,b,c,d={};if(1===arguments.length?c=arguments[0]:2===arguments.length?(b=arguments[0],c=arguments[1]):(b=arguments[0],d=arguments[1],c=arguments[2]),"string"==typeof c&&(c=this.templates[c]),"function"!=typeof c)throw new Error("InvalidArgumentsException: Invalid template function: "+c);if(b&&"object"!==typeOf(b))throw new Error('InvalidArgumentsException: Invalid "ref" parameter');return 0===this.isInline?(this.dataReference=d,this.references=b):d||(d=this.dataReference),a=arguments.length>3?c.apply(this,[this.createElement,d].append(Array.prototype.slice.call(arguments,3))):c.call(this,this.createElement,d)},renderInline:function(a,b){this.isInline++;var c=this.render.apply(this,[this.references,b,a].append(Array.prototype.slice.call(arguments,2)));return this.isInline--,c},storeReference:function(a,b){void 0!==this.references&&(this.references[a]=b)}}),gx.ui.TemplateContainer=new Class({Implements:Events,_elmt:null,_ui:{},rendered:!1,initialize:function(a){this.runRenderer(a)},runRenderer:function(a){return a||(a=this.data||{}),"function"==typeof this.preRender&&this.preRender(a),this.rendered?this._elmt=this.renderUpdate(a):(this._elmt=this.render(a),this.rendered=!0),"function"==typeof this.postRender&&this.postRender(),this._elmt},render:function(a){var b=gx.ui.Templates.render(this._ui,a,this.template.bind(this)),c=this.connectEvents;return c&&c.length>0&&this.bindThisEvents(c,this._ui),b},renderUpdate:function(a){return this._elmt.getParent()?this.render(a).replaces(this._elmt):this.render(a)},bindThisEvents:function(a,b,c,d){b||(b=this),c||(c=this),d||(d=this);var e,f,g,h,i,j;for(f=0,g=a.length;g>f;f++)e=a[f].split(":"),h=b[e[0]],h&&(i=e[1],j=c[e[2]],"function"!=typeof j?h.addEvent(i,this.fireEvent.bind(d,e[2])):h.addEvent(i,j.bind(d)))},template:function(){},elmt:function(a){return this._ui[a]},toElement:function(){if(!this._elmt)throw new Error("TemplateContainer not (properly) rendered!");return this._elmt},destroy:function(){this._elmt&&this._elmt.destroy()}}),gx.ui.Templates=new gx.ui.TemplatesClass,gx.ui.Timebox=new Class({gx:"gx.ui.Timebox",Extends:gx.ui.Container,options:{time:0,unit:"minutes",seconds:!0,prefix:!1,readonly:!1,disabled:!1},_prefix:!0,_styles:{negative:{background:"#FBE3E4",color:"#8a1f11","border-color":"#FBC2C4"},positive:{background:"#E6EFC2",color:"#264409","border-color":"#C6D880"}},initialize:function(a,b){try{this.parent(a,b),this.build()}catch(c){gx.util.Console("gx.ui.Timebox->initialize",c.message)}},build:function(){var a=this;try{this.options.prefix&&(this._display.prefix=new Element("div",{html:"+",styles:Object.merge({},this._styles.positive,{height:"18px",width:"18px","text-align":"center",cursor:"pointer","font-weight":"bold","font-size":"12px",padding:"1px","margin-right":"3px","border-width":"1px","border-style":"solid","float":"left"})}),this._display.root.adopt(this._display.prefix),this._display.prefix.addEvent("click",function(){a.options.disabled||gx.ui.Timebox.legacyMode&&a.options.readonly||a.setPrefix(!a._prefix)})),this._display.hours=new Element("input",{type:"text",styles:{width:"25px","text-align":"center"}}),this._display.root.adopt(this._display.hours),this._display.hours.addEvent("change",function(){a.update()}),this._display.minutes=new Element("input",{type:"text",styles:{width:"25px","text-align":"center"}}),this._display.root.adopt(new Element("span",{html:":"})),this._display.root.adopt(this._display.minutes),this._display.minutes.addEvent("change",function(){a.update()});var b=this.options.readonly&&!gx.ui.Timebox.legacyMode,c=this.options.disabled||gx.ui.Timebox.legacyMode&&this.options.readonly;this.options.seconds&&(this._display.seconds=new Element("input",{type:"text",styles:{width:"25px","text-align":"center"}}),this._display.root.adopt(new Element("span",{html:":"})),this._display.root.adopt(this._display.seconds),this._display.seconds.addEvent("change",function(){a.update()}),b&&this._display.seconds.set("readonly","readonly")),b&&(this._display.hours.set("readonly","readonly"),this._display.minutes.set("readonly","readonly")),c&&this.disable()}catch(d){gx.util.Console("gx.ui.Timebox->build",d.message)}},setPrefix:function(a){try{this._display.prefix&&(this._prefix=a,this._prefix?(this._display.prefix.setStyles(this._styles.positive),this._display.prefix.set("html","+")):(this._display.prefix.setStyles(this._styles.negative),this._display.prefix.set("html","-")))}catch(b){gx.util.Console("gx.ui.Timebox->setPrefix",b.message)}return this},addZero:function(a){return 10>a?"0"+a:a},update:function(){return this.set(this.get())},splitTime:function(a,b){try{null==b&&(b=this.options.unit);var c=a>=0;c||(a=-a),"minutes"==b?a=60*a:"hours"==b&&(a=3600*a),a=Math.round(a);var d=0,e=Math.round(a/60);this.options.seconds&&(d=a%60,e=Math.floor(a/60));var f=Math.floor(e/60);return e%=60,{hours:f,minutes:this.addZero(e),seconds:this.addZero(d),prefix:c}}catch(g){throw gx.util.Console("gx.ui.Timebox->splitTime",g.message),g}return this},getNum:function(a){var b=parseInt(a.get("value"),10);return isNaN(b)?0:(0>b&&(this.setPrefix(!1),b=-b),b)},set:function(a,b){try{null==a&&(a=0),null==b&&(b=this.options.unit),a=this.splitTime(parseFloat(a),b),a.prefix||this.options.prefix?(this.setPrefix(a.prefix),this._display.hours.set("value",a.hours),this._display.minutes.set("value",a.minutes),this._display.seconds&&this._display.seconds.set("value",a.seconds)):(this._display.hours.set("value",0),this._display.minutes.set("value",0),this._display.seconds&&this._display.seconds.set("value",0))}catch(c){gx.util.Console("gx.ui.Timebox->set",c.message)}return this},get:function(a,b){try{null==b&&(b=0),null==a&&(a=this.options.unit);var c=this.getNum(this._display.hours),d=this.getNum(this._display.minutes),e=0;this._display.seconds&&(e=this.getNum(this._display.seconds));var f=(this._prefix?1:-1)*(3600*c+60*d+e);switch(a){case"hours":return Math.round(f/3600*Math.pow(10,b))/Math.pow(10,b);case"minutes":return Math.round(f/60*Math.pow(10,b))/Math.pow(10,b);default:return Math.round(f*Math.pow(10,b))/Math.pow(10,b)}}catch(g){throw gx.util.Console("gx.ui.Timebox->get",g.message),g}},enable:function(){return this.options.disabled=!1,this._display.hours.erase("disabled"),this._display.minutes.erase("disabled"),this._display.seconds&&this._display.seconds.erase("disabled"),this},disable:function(){return this.options.disabled=!0,this._display.hours.set("disabled","disabled"),this._display.minutes.set("disabled","disabled"),this._display.seconds&&this._display.seconds.set("disabled","disabled"),this},disabled:function(){return this.options.disabled}}),gx.ui.Timebox.legacyMode=!0,gx.ui.Toggling=new Class({gx:"gx.ui.Toggling",Implements:[Options,Events],options:{rootClass:"toggling",stateClass:"active",initState:!0},_state:!0,initialize:function(a,b){this.setOptions(b),this._ui={},this._ui.root="element"===typeOf(a)?a:new Element("div"),this.options.rootClass&&this._ui.root.addClass(this.options.rootClass),this._state=!this.options.initState,this.toggle()},toggle:function(){this._state?this.deactivate.apply(this,arguments):this.activate.apply(this,arguments)},deactivate:function(a){this._state=!1,this._ui.root.removeClass(this.options.stateClass),a!==!0&&(this.fireEvent("stateDeactivated",[this]),this.fireEvent("stateChanged",[this._state,this]))},activate:function(a){this._state=!0,this._ui.root.addClass(this.options.stateClass),a!==!0&&(this.fireEvent("stateActivated",[this]),this.fireEvent("stateChanged",[this._state,this]))},getState:function(){return this._state},toElement:function(){return this._ui.root}});